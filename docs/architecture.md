# HC Architecture

## Overview

HC (Hierarchical C) is an indentation-based interface for writing C code.

The compiler is not a full C parser.  
Instead, HC works as a structural preprocessor that converts indentation-based syntax into valid C code.

Pipeline:

HC Source (.hc)
    ↓
Indentation Engine (v0.1) ✅
    ↓
Block Generator (v0.2) ✅
    ↓
Semicolon Inserter (planned)
    ↓
C Output (.c)
    ↓
GCC / Clang

---

## Design Philosophy

HC does NOT reimplement the C compiler.

Instead, it:

- Preserves full C syntax compatibility
- Converts indentation into `{}` blocks
- Automatically inserts `;` where required
- Delegates semantic validation to GCC/Clang

This keeps the project:

- Simple
- Maintainable
- Fully compatible with modern C

---

## Indentation Engine (v0.1)

The indentation engine is responsible for:

- Reading source lines
- Detecting indentation levels
- Emitting structural tokens

### Generated Tokens

- `LINE`   → Represents a line of code
- `INDENT` → Represents block entry
- `DEDENT` → Represents block exit

### Example

HC Input:

```c
int main()
    int x = 10
    if (x > 5)
        x++
    return 0
```

Generated Tokens:
```c
LINE int main()
INDENT
LINE int x = 10
LINE if (x > 5)
INDENT
LINE x++
DEDENT
LINE return 0
DEDENT
```

---

## Block Generator (v0.2)

The Block Generator is responsible for converting structural indentation tokens into C block delimiters.

It receives the tokens produced by the Indentation Engine and transforms them into valid C block syntax.

### Responsibilities

- Convert `INDENT` → `{`
- Convert `DEDENT` → `}`
- Preserve `LINE` tokens as-is

It does **not**:

- Insert semicolons
- Validate C syntax
- Format code output

---

### Example

#### Input Tokens
```c
LINE int main()
INDENT
LINE int x = 10
LINE if (x > 5)
INDENT
LINE x++
DEDENT
LINE return 0
DEDENT
```


#### Generated Output

```c
int main()
{
int x = 10
if (x > 5)
{
x++
}
return 0
}
```

---

## Semicolon Inserter (v0.3)

The Semicolon Inserter is responsible for transforming block-structured C code into fully valid C syntax by automatically inserting `;` where required.

It receives the output generated by the Block Generator and applies rule-based heuristics to determine whether a semicolon should be appended to each line.

### Responsibilities

- Insert `;` after:
  - Variable declarations
  - Expressions
  - Function calls
  - `return`, `break`, `continue`
- Preserve correct syntax for:
  - Function definitions
  - Control structures (`if`, `for`, `while`, `switch`)
  - `else`, `do`
  - `case` and `default`
  - Preprocessor directives
  - `{` and `}`

### Heuristic Strategy

The module uses pattern-based detection to:

- Distinguish function definitions from function calls
- Avoid inserting semicolons after control structures
- Avoid modifying lines that already end with `;`

It does **not**:

- Perform full C syntax validation
- Replace the C compiler
- Interpret semantic meaning

Semantic correctness remains the responsibility of GCC/Clang.

---

### Example

#### Input

```c
int main(),
    int x = 10
    int y = 20
    if (x > 5)
        x++
    else
        x--
    for (int i = 0; i < 5; i++)
        printf(\"%d", i)
    while (x < y)
        x++
    switch (x)
        case 1
            break
        default
        break
    return 0
```

#### Output in C

```c
int main() {
  int x = 10;
  int y = 20;
  if (x > 5) {
    x++;
  } else {
    x--;
  }
  for (int i = 0; i < 5; i++) {
    printf("%d", i);
  }
  while (x < y) {
    x++;
  }
  switch (x) {
  case 1: {
    break;
  }
  default: {
    break;
  }
  }
  return 0;
}
 ```

 ---

## Transpiler Core (v0.4)

The Transpiler Core orchestrates all transformation modules and produces the final C output.

It is responsible for:

- Reading `.hc` source files
- Executing the transformation pipeline
- Writing the generated `.c` file

### Pipeline Execution

1. Read source file
2. Run Indentation Engine
3. Run Block Generator
4. Run Semicolon Inserter
5. Write output file

### Responsibility Separation

The Transpiler Core does not:

- Perform syntax validation
- Format code
- Compile C code

It only coordinates transformation stages.

---

### Example Usage
```c
examples/hello.hc

#include <stdio.h>

int main()
    printf("Hello, HC")
    return 0
```
Run:
```bash
lua tests/test_transpiler.lua
gcc examples/hello.c -o hello
./hello
```
Output: Hello, HC

---

## CLI Interface (v0.5)

The CLI Interface provides command-line access to the HC transpiler.

It allows users to:

- Transpile `.hc` files into `.c`
- Optionally compile and execute the generated C code

Example usage:

```bash
lua bin/hc.lua examples/hello.hc
```
With execution:
```bash
lua bin/hc.lua examples/hello.hc --run
```